<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>English Speech Cleaner</title>
</head>

<body>
<h1>English Dysarthria Cleaner</h1>
<p>Upload a dysarthric Russian audio file (.wav) to get a cleaned version and see its spectrograms.</p>

<form id="audioForm" enctype="multipart/form-data">
  <input type="file" id="audioFile" name="audio" accept="audio/wav" required>
  <button type="submit">Predict</button>
</form>

<p id="output" style="font-weight: bold; margin-top: 20px;"></p>

<div id="results" style="display:none; margin-top: 20px;">
  <h3>Original Spectrogram</h3>
  <img id="originalSpectrogram" src="" alt="Original Spectrogram" style="max-width: 300px;"><br>

  <h3>Predicted Clean Spectrogram</h3>
  <img id="predictedSpectrogram" src="" alt="Clean Spectrogram" style="max-width: 300px;"><br>

  <h3>Clean Audio</h3>
  <audio id="cleanAudio" controls></audio>
</div>

<script>
  const form = document.getElementById('audioForm');
  const output = document.getElementById('output');
  const results = document.getElementById('results');
  const originalImg = document.getElementById('originalSpectrogram');
  const predictedImg = document.getElementById('predictedSpectrogram');
  const cleanAudio = document.getElementById('cleanAudio');

  form.onsubmit = async (event) => {
    event.preventDefault();

    const fileInput = document.getElementById('audioFile');
    if (fileInput.files.length === 0) {
      output.textContent = 'Please select an audio file.';
      return;
    }

    const formData = new FormData();
    formData.append('audio', fileInput.files[0]);

    output.textContent = 'Processing...';
    results.style.display = 'none';

    try {
      const response = await fetch('/englishpredict', {
        method: 'POST',
        body: formData
      });

      if (!response.ok) {
        const errorData = await response.json();
        output.textContent = 'Error: ' + (errorData.error || 'Something went wrong');
        return;
      }

      const data = await response.json();

      originalImg.src = 'data:image/png;base64,' + data.spectrogram_image;
      predictedImg.src = 'data:image/png;base64,' + data.predicted_spectrogram_image;
      cleanAudio.src = 'data:audio/wav;base64,' + data.clean_audio;

      output.textContent = 'Success! See results below.';
      results.style.display = 'block';

    } catch (error) {
      output.textContent = 'Error: ' + error.message;
    }
  };
</script>
</body>
</html>

